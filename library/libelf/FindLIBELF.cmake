if (LIBELF_INCLUDE_DIR AND LIBELF_LIBRARY)
    set(LIBELF_FOUND TRUE)
else()
    pkg_check_modules(PKG_CONFIG_LIBELF libelf)

    message("PKG_CONFIG_LIBELF_FOUND=${PKG_CONFIG_LIBELF_FOUND}")
    message("PKG_CONFIG_LIBELF_INCLUDE_DIRS=${PKG_CONFIG_LIBELF_INCLUDE_DIRS}")
    message("PKG_CONFIG_LIBELF_LIBRARY_DIRS=${PKG_CONFIG_LIBELF_LIBRARY_DIRS}")
    message("PKG_CONFIG_LIBELF_INCLUDEDIR=${PKG_CONFIG_LIBELF_INCLUDEDIR}")
    message("PKG_CONFIG_LIBELF_LIBDIR=${PKG_CONFIG_LIBELF_LIBDIR}")
    message("PKG_CONFIG_LIBELF_VERSION=${PKG_CONFIG_LIBELF_VERSION}")
    message("PKG_CONFIG_LIBELF_LIBRARY=${PKG_CONFIG_LIBELF_LIBRARY}")
    message("PKG_CONFIG_LIBELF_LINK_LIBRARIES=${PKG_CONFIG_LIBELF_LINK_LIBRARIES}")

    if (PKG_CONFIG_LIBELF_FOUND)
        if (PKG_CONFIG_LIBELF_INCLUDE_DIRS)
            set(LIBELF_INCLUDE_DIR "${PKG_CONFIG_LIBELF_INCLUDE_DIRS}")
	    elseif (PKG_CONFIG_LIBELF_INCLUDEDIR)
        	set(LIBELF_INCLUDE_DIR "${PKG_CONFIG_LIBELF_INCLUDEDIR}")
	    else()
		    find_path(LIBELF_INCLUDE_DIR libelf.h)
	    endif()

        set(LIBELF_LIBRARY ${PKG_CONFIG_LIBELF_LINK_LIBRARIES})

        if (NOT TARGET  LIBELF::libelf)
            add_library(LIBELF::libelf INTERFACE IMPORTED)
            set_target_properties(LIBELF::libelf PROPERTIES
                INTERFACE_INCLUDE_DIRECTORIES "${LIBELF_INCLUDE_DIR}"
                INTERFACE_LINK_LIBRARIES      "${LIBELF_LIBRARY}"
            )
        endif()

        if (PKG_CONFIG_LIBELF_VERSION)
            set(LIBELF_VERSION_STRING ${PKG_CONFIG_LIBELF_VERSION})
        endif()
    endif()
endif()

include(FindPackageHandleStandardArgs)
find_package_handle_standard_args(LIBELF REQUIRED_VARS LIBELF_LIBRARY LIBELF_INCLUDE_DIR VERSION_VAR LIBELF_VERSION)

mark_as_advanced(LIBELF_INCLUDE_DIR LIBELF_LIBRARY)
